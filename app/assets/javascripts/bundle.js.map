{"version":3,"sources":["webpack:///webpack/bootstrap 3c1012b46daf67736fde","webpack:///./app/assets/javascripts/tower.js","webpack:///./app/assets/javascripts/index.js","webpack:///./app/assets/javascripts/game.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;AChEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oFAAoF;AACpF;AACA;AACA;AACA;AACA;AACA,gFAAgF;AAChF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,mCAAmC,OAAO,GAAG,QAAQ;AACrD,uCAAuC,KAAK;AAC5C;AACA;AACA;AACA;;AAEA;;;;;;;;;;AC3CA;;AAEA;AACA;AACA,CAAC;;;;;;;;;ACJD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;;AAEL;;AAEA,KAAK;AACL;;AAEA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,gDAAgD,KAAK;AACrD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,gBAAgB,kBAAkB,+BAA+B,kBAAkB;AACnF;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA,uCAAuC;;AAEvC;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA,mBAAmB,kBAAkB;AACrC;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B,WAAW,UAAU,YAAY;AAC7D,4BAA4B,YAAY;AACxC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,kBAAkB;AACrC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gDAAgD,kBAAkB;AAClE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3c1012b46daf67736fde","const SVGNS = \"http://www.w3.org/2000/svg\";\n\nclass Tower {\n  constructor(type, pos) {\n    this.level = 1;\n    this.pos = pos;\n\n    switch (type) {\n      case \"arrow\":\n        this.damage = [30, 60, 120, 240, 480];\n        this.range = [120, 140, 160, 180, 200];\n        this.price = [60, 60, 120, 240, 480];\n        this.interval = [40, 35, 30, 25, 20];\n      case \"ice\":\n        this.damage = [30, 60, 120, 240, 480];\n        this.range = [120, 140, 160, 180, 200];\n        this.price = [60, 60, 120, 240, 480];\n        this.interval = [40, 35, 30, 25, 20];\n        this.slow = [[0.3, 100], [0.45, 120], [0.6, 140], [0.75, 160], [0.85, 200]]; // amount, duration\n      case \"cannon\":\n        this.damage = [30, 60, 120, 240, 480];\n        this.range = [120, 140, 160, 180, 200];\n        this.price = [60, 60, 120, 240, 480];\n        this.interval = [40, 35, 30, 25, 20];\n        this.splash = [[0.3, 50], [0.35, 55], [0.4, 60], [0.45, 65], [0.5, 70]]; // amount, radius\n      case \"assassin\":\n        this.damage = [30, 60, 120, 240, 480];\n        this.range = [120, 140, 160, 180, 200];\n        this.price = [60, 60, 120, 240, 480];\n        this.interval = [40, 35, 30, 25, 20];\n        this.percentMissing = [8, 11, 14, 17, 20];\n    }\n\n    let svg = document.createElementNS(SVGNS, \"rect\");\n    svg.setAttribute(\"x\", pos[0]);\n    svg.setAttribute(\"y\", pos[1]);\n    svg.setAttribute(\"id\", `type_${pos[0]}_${pos[1]}}`);\n    svg.setAttribute(\"class\", `tower ${type}`);\n    $(\"#game\").append(svg);\n    this.svg = svg;\n  }\n}\n\nexport default Tower;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./app/assets/javascripts/tower.js\n// module id = 0\n// module chunks = 0","import Game from \"./game\";\n\n$(document).ready(() => {\n  new Game();\n});\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./app/assets/javascripts/index.js\n// module id = 1\n// module chunks = 0","import Tower from \"./tower\";\nconst SVGNS = \"http://www.w3.org/2000/svg\";\nconst PATH_D = \"M 180 0 L 180 140 L 100 140 L 100 420 L 300 420 L 300 100 L 620 100 L 620 220 L 420 220 L 420 340 L 800 340\";\nconst TOWERS = {\n  arrow: {\n    name: \"Arrow\",\n    price: 60,\n    index: 1,\n    description: \"Low damage but high range and rate of fire.\",\n    range: 120,\n  },\n  ice: {\n    name: \"Ice\",\n    price: 80,\n    index: 2,\n    description: \"Medium damage, range, and rate of fire. Slows enemies.\",\n    range: 100,\n  },\n  cannon: {\n    name: \"Cannon\",\n    price: 100,\n    index: 3,\n    description: \"High damage but low range and rate of fire. Applies splash damage to nearby enemies.\",\n    range: 100\n  },\n  assassin: {\n    name: \"Assassin\",\n    price: 150,\n    index: 4,\n    description: \"High range but low rate of fire. Deals more damage to low-health targets.\",\n    range: 120\n  },\n};\n\nclass Game {\n  constructor() {\n    this.$field = $(\"#field\");\n\n    this.offset = this.$field.offset();\n    this.grid = {\n      increment: 40,\n      height: 13,\n      width: 20\n    }\n\n    this.buildPath();\n    this.buildIndicators();\n    this.loadTooltips();\n    this.addListeners();\n    this.newGame();\n  }\n\n  newGame() {\n    this.gold = 240;\n  }\n\n  buildPath() {\n    let path = document.createElementNS(SVGNS, \"path\");\n    path.setAttribute(\"d\", PATH_D);\n    path.setAttribute(\"id\", \"path\");\n    path.setAttribute(\"class\", \"path\");\n    $(\"#game\").append(path);\n  }\n\n  buildIndicators() {\n    let selection = document.createElementNS(SVGNS, \"rect\");\n    selection.setAttribute(\"x\", 0);\n    selection.setAttribute(\"y\", 0);\n    selection.setAttribute(\"visibility\", \"hidden\");\n    selection.setAttribute(\"class\", \"button selection\");\n\n    let range = document.createElementNS(SVGNS, \"circle\");\n    range.setAttribute(\"class\", \"range\");\n\n    $(\"#game\").append(selection);\n    $(\"#game\").append(range);\n\n    this.$selection = $(selection);\n    this.$range = $(range);\n  }\n\n  addListeners() {\n    this.addFieldListeners();\n    this.addBuyListeners();\n  }\n\n  addFieldListeners() {\n    let field = this.$field;\n    field.on(\"mousemove\", (e) => {\n      this.mouseOverField(e);\n    });\n\n    field.on(\"click\", (e) => {\n\n    });\n  }\n\n  addBuyListeners() {\n    $(\".buy\").on(\"click\", (e) => {\n      this.clickBuy(e);\n    });\n\n    $(\".buy\").on(\"mouseover\", (e) => {\n      this.mouseOverBuy(e);\n    });\n\n    $(\".buy\").on(\"mouseleave\", (e) => {\n      this.mouseLeaveBuy(e);\n    });\n  }\n\n  loadTooltips() {\n    this.loadBuy();\n  }\n\n  loadBuy() {\n    let svgHeight = 24;\n    let svgWidth = 24;\n    let boxHeight = 50;\n    let boxWidth = 240;\n\n    let tooltipGroup = document.createElementNS(SVGNS, \"g\");\n    let tooltipBox = document.createElementNS(SVGNS, \"rect\");\n    $(tooltipBox).attr(\"class\", \"tooltip\");\n\n    let title = document.createElementNS(SVGNS, \"tspan\");\n    $(title).attr(\"class\", \"title\")\n\n    let price = document.createElementNS(SVGNS, \"tspan\");\n    $(price).attr(\"class\", \"price\")\n\n    let desc = document.createElementNS(SVGNS, \"tspan\");\n    $(desc).attr(\"class\", \"description\")\n\n    let tooltipText = document.createElementNS(SVGNS, \"text\");\n    $(tooltipText).attr(\"class\", \"tooltip-text\");\n\n    tooltipText.appendChild(title);\n    tooltipText.appendChild(price);\n    tooltipText.appendChild(desc);\n\n    $(tooltipGroup).attr(\"opacity\", \"0.9\");\n    $(tooltipBox).attr(\"height\", 50);\n\n    tooltipGroup.appendChild(tooltipBox);\n    tooltipGroup.appendChild(tooltipText);\n\n    this.tooltipBuy = {\n      group: tooltipGroup,\n      box: tooltipBox,\n      text: tooltipText,\n      title,\n      price,\n      desc,\n      svgHeight,\n      svgWidth,\n      boxHeight,\n      boxWidth\n    }\n  }\n\n  clickBuy(e) {\n    this.clearSelection();\n    this.buy(e.target);\n  }\n\n  buy(svg) {\n    let id = $(svg).attr(\"id\");\n    let type = id.slice(id.indexOf(\"_\") + 1, id.length);\n\n    if (TOWERS[type].price > this.gold) {\n      return;\n    }\n\n    $(svg).attr(\"class\", `button buy selected ${type}`);\n    this.building = true;\n    this.buildingType = type;\n  }\n\n  clearSelection(keepCursorOn) {\n    if (this.selectedTower != null) {\n      this.selectedTower.selected = false;\n      $(\"#tower_details_group\").attr(\"visibility\", \"hidden\");\n      this.selectedTower = null;\n    }\n    if (this.selectedMinion != null) {\n      this.selectedMinion.selected = false;\n      $(\"#minion_details_group\").attr(\"visibility\", \"hidden\");\n      this.selectedMinion = null;\n    }\n\n    if ((this.building) && (keepCursorOn == undefined)) {\n      this.building = false;\n      $(`#buy_${this.buildingType}`).attr(\"class\", `button buy ${this.buildingType}`);\n    }\n  }\n\n\n  mouseOverBuy(e) {\n    let svg = e.target;\n\n    let svgHeight = this.tooltipBuy.svgHeight;\n    let svgWidth = this.tooltipBuy.svgWidth;\n    let boxHeight = this.tooltipBuy.boxHeight;\n    let boxWidth = this.tooltipBuy.boxWidth;\n\n    let x = parseInt($(svg).attr(\"x\")) + 0.5 * parseInt(svgWidth) - 0.5 * boxWidth;\n    if (x < 0) {\n      x = 0;\n    } else if (x + boxWidth >= parseInt($(\"#game\").attr(\"width\"))) {\n      x = parseInt($(\"#game\").attr(\"width\")) - boxWidth;\n    }\n\n    let y = parseInt($(svg).attr(\"y\")) + parseInt(svgHeight) + 10;\n\n    let box = this.tooltipBuy.box;\n    $(box).attr(\"x\", x);\n    $(box).attr(\"y\", y);\n\n    let details = this.getDetails(svg); // title, price, description\n\n    let title = this.tooltipBuy.title;\n    $(title).text(details[0]);\n    $(title).attr(\"x\", x + 0.5 * boxWidth);\n    $(title).attr(\"y\", y + 20);\n\n    let price = this.tooltipBuy.price;\n    $(price).text(details[1]);\n    $(price).attr(\"x\", x + boxWidth - 36);\n    $(price).attr(\"y\", y + 20);\n\n    let group = this.tooltipBuy.group;\n    $(group).attr(\"opacity\", \"0.9\");\n\n    let text = this.tooltipBuy.text;\n    let desc = this.tooltipBuy.desc;\n\n    let descs = this.processText(text, details[2], x, y, boxWidth);\n    for (let i = 0; i < descs.length; i++) {\n      desc.appendChild(descs[i]);\n    }\n\n    $(box).attr(\"height\", 36 + 14 * descs.length);\n\n    $(\"#game\").append(group);\n  }\n\n  getDetails(svg) {\n    let details = []; // title, price, description\n    let svgClass = $(svg).attr(\"class\");\n    if (svgClass == undefined) {\n      if ($(svg).attr(\"xlink:href\") != undefined) {\n        svgClass = $($(svg).attr(\"xlink:href\")).attr(\"class\");\n      }\n      if (svgClass == undefined) {\n        return;\n      }\n    }\n\n    let id = $(svg).attr(\"id\");\n    let buttonType = svgClass.slice(svgClass.indexOf(\" \") + 1, svgClass.length);\n    switch (buttonType) {\n        case \"buy\":\n            let type = id.slice(id.indexOf(\"_\") + 1, id.length);\n            let tower = TOWERS[type]\n            details[0] = `${tower.name} Tower (${tower.index})`;\n            details[1] = `${tower.price} g`;\n            details[2] = tower.description;\n          break;\n    }\n    return details;\n  }\n\n  processText(svg, text, x, y, box_width) {\n    // line wrapping, since this doesn't exist in SVG\n    let descs = [];\n    descs = this.processTextRecursive(descs, text, 0);\n\n    let descSvg = [];\n    for (let i = 0; i < descs.length; i++) {\n      let desc = document.createElementNS(SVGNS, \"tspan\");\n      $(desc).attr(\"x\", x + 0.5 * box_width);\n      $(desc).attr(\"y\", y + 36 + (12 * i));\n      $(desc).attr(\"class\", \"description\");\n      $(desc).text(descs[i]);\n      descSvg.push(desc);\n    }\n    return descSvg;\n  }\n\n  processTextRecursive(descs, text, i) {\n    if (text.length == 0) {\n      return descs;\n    }\n    let maxLength = 40;\n    if (text.length <= maxLength) {\n      descs[i] = text;\n      return descs;\n    }\n\n    let substr_raw = text.slice(0, maxLength);\n    let lastSpace = substr_raw.lastIndexOf(\" \");\n    if (lastSpace == -1) {\n      descs = null;\n      descs = [\"Error: Overflow\"];\n      return descs;\n    }\n    let substrCut = substr_raw.slice(0, lastSpace);\n    let remainder = text.slice(lastSpace + 1, text.length);\n    descs[i] = substrCut;\n\n    return this.processTextRecursive(descs, remainder, i + 1);\n  }\n\n  mouseLeaveBuy(e) {\n    $(this.tooltipBuy.group).remove();\n    $(this.tooltipBuy.desc).empty();\n  }\n\n  mouseOverField(e) {\n    if (!this.building) {\n      return;\n    }\n    let tower = TOWERS[this.buildingType];\n\n    let coords = this.getGridCoordinates(e);\n    let increment = this.grid.increment;\n    let x = coords[0];\n    let y = coords[1];\n\n    let selection = this.$selection;\n    selection.attr(\"x\", (x * increment));\n    selection.attr(\"y\", (y * increment));\n    selection.attr(\"class\", `button selection ${this.buildingType}`);\n    selection.attr(\"visibility\", \"visible\");\n\n    let range = this.$range;\n    range.attr(\"cx\" , (x + 0.5) * increment);\n    range.attr(\"cy\", (y + 0.5) * increment);\n    // range.attr(\"fill\", tower.color)\n    range.attr(\"r\", tower.range);\n    range.attr(\"visibility\", \"visible\");\n  }\n\n  getGridCoordinates(e) {\n    let coords = [];\n    let increment = this.grid.increment;\n    let width = this.grid.width;\n    let height = this.grid.height;\n\n    let x = Math.floor((e.clientX - this.offset.top) / increment);\n    let y = Math.floor((e.clientY - this.offset.top) / increment);\n\n    if (x >= width) {\n      x = width - 1;\n    }\n    if (y >= height) {\n      y = height - 1;\n    }\n\n    coords[0] = x;\n    coords[1] = y;\n    return coords;\n  }\n}\n\nexport default Game;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./app/assets/javascripts/game.js\n// module id = 2\n// module chunks = 0"],"sourceRoot":""}